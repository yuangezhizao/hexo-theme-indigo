(function(p,B){var q=B.body,k=B.querySelector.bind(B),r=B.querySelectorAll.bind(B),v=k("html"),t=k("#gotop"),a=k("#menu"),y=k("#header"),x=k("#mask"),u=k("#menu-toggle"),o=k("#menu-off"),h=k("#loading"),l=p.requestAnimationFrame,s=200/(1000/60),z=Array.prototype.forEach,n=("ontouchstart" in p&&/Mobile|Android|iOS|iPhone|iPad|iPod|Windows Phone|KFAPWI/i.test(navigator.userAgent))?"touchstart":"click",C=/micromessenger/i.test(navigator.userAgent),f=function(){},m=function(w){var d=w.offsetLeft,E=w.offsetTop;if(w.offsetParent){var D=arguments.callee(w.offsetParent);d+=D.x;E+=D.y}return{x:d,y:E}},A=function(){return B.documentElement.scrollTop||B.body.scrollTop};var c={goTop:function(d){var D=A();var w=arguments.length>2?arguments[1]:Math.abs(D-d)/s;if(D&&D>d){p.scrollTo(0,Math.max(D-w,0));l(arguments.callee.bind(this,d,w))}else{if(d&&D<d){p.scrollTo(0,Math.min(D+w,d));l(arguments.callee.bind(this,d,w))}else{this.toc.actived(d)}}},toggleGotop:function(d){if(d>p.innerHeight/2){t.classList.add("in")}else{t.classList.remove("in")}},toggleMenu:function(w){var d=k("#main");if(w){a.classList.remove("hide");if(p.innerWidth<1241){x.classList.add("in");a.classList.add("show");if(C){var D=A();d.classList.add("lock");d.scrollTop=D}else{v.classList.add("lock")}}}else{a.classList.remove("show");x.classList.remove("in");if(C){var D=d.scrollTop;d.classList.remove("lock");p.scrollTo(0,D)}else{v.classList.remove("lock")}}},fixedHeader:function(d){if(d>y.clientHeight){y.classList.add("fixed")}else{y.classList.remove("fixed")}},toc:(function(){var H=k("#post-toc");if(!H||!H.children.length){return{fixed:f,actived:f}}var F=k(".post-header").clientHeight,D=y.clientHeight,E=k("#post-content").querySelectorAll("h1, h2, h3, h4, h5, h6");H.querySelector('a[href="#'+E[0].id+'"]').parentNode.classList.add("active");var G=H.querySelectorAll(".post-toc-child");for(i=0,len=G.length;i<len;i++){G[i].classList.add("post-toc-shrink")}var w=H.querySelector('a[href="#'+E[0].id+'"]').nextElementSibling;if(w){w.classList.add("post-toc-expand");w.classList.remove("post-toc-shrink")}H.classList.remove("post-toc-shrink");var d=function(L,J){L.classList.remove("active");J.classList.add("active");var I=J.parentElement.querySelectorAll(".post-toc-child");for(j=0,len1=I.length;j<len1;j++){I[j].classList.remove("post-toc-expand");I[j].classList.add("post-toc-shrink")}var K=J.querySelector(".post-toc-child");if(K){K.classList.remove("post-toc-shrink");K.classList.add("post-toc-expand")}};return{fixed:function(I){I>=F-D?H.classList.add("fixed"):H.classList.remove("fixed")},actived:function(K){for(i=0,len=E.length;i<len;i++){if(K>m(E[i]).y-D-5){var J=H.querySelector("li.active");var I=H.querySelector('a[href="#'+E[i].id+'"]').parentNode;d(J,I)}}if(K<m(E[0]).y){d(H.querySelector("li.active"),H.querySelector('a[href="#'+E[0].id+'"]').parentNode)}}}})(),hideOnMask:[],modal:function(d){this.$modal=k(d);this.$off=this.$modal.querySelector(".close");var w=this;this.show=function(){x.classList.add("in");w.$modal.classList.add("ready");setTimeout(function(){w.$modal.classList.add("in")},0)};this.onHide=f;this.hide=function(){w.onHide();x.classList.remove("in");w.$modal.classList.remove("in");setTimeout(function(){w.$modal.classList.remove("ready")},300)};this.toggle=function(){return w.$modal.classList.contains("in")?w.hide():w.show()};c.hideOnMask.push(this.hide);this.$off&&this.$off.addEventListener(n,this.hide)},share:function(){var w=k("#pageShare"),D=k("#shareFab");var d=new this.modal("#globalShare");k("#menuShare").addEventListener(n,d.toggle);if(D){D.addEventListener(n,function(){w.classList.toggle("in")},false);B.addEventListener(n,function(F){!D.contains(F.target)&&w.classList.remove("in")},false)}var E=new this.modal("#wxShare");E.onHide=d.hide;z.call(r(".wxFab"),function(F){F.addEventListener(n,E.toggle)})},search:function(){var d=k("#search-wrap");function w(){d.classList.toggle("in")}k("#search").addEventListener(n,w)},waterfall:function(){if(p.innerWidth<760){return}z.call(r(".waterfall"),function(w){var D=w.querySelectorAll(".waterfall-item");var d=[0,0];z.call(D,function(F){var E=d[0]<=d[1]?0:1;F.style.cssText="top:"+d[E]+"px;left:"+(E>0?"50%":0);d[E]+=F.offsetHeight});w.style.height=Math.max(d[0],d[1])+"px";w.classList.add("in")})},tabBar:function(d){d.parentNode.parentNode.classList.toggle("expand")},page:(function(){var d=r(".fade, .fade-scale");var w=false;return{loaded:function(){z.call(d,function(D){D.classList.add("in")});w=true},unload:function(){z.call(d,function(D){D.classList.remove("in")});w=false},visible:w}})(),lightbox:(function(){function d(E){this.$img=E.querySelector("img");this.$overlay=E.querySelector("overlay");this.margin=40;this.title=this.$img.title||this.$img.alt||"";this.isZoom=false;var H,w,F,D,G;this.calcRect=function(){D=q.clientWidth;G=q.clientHeight;var M=G-this.margin*2;var L=H;var Q=w;var O=this.margin;var K=0;var J=L>D?D/L:1;var N=Q>M?M/Q:1;var P=Math.min(J,N);L=L*P;Q=Q*P;return{w:L,h:Q,t:(G-Q)/2-F.top,l:(D-L)/2-F.left+this.$img.offsetLeft}};this.setImgRect=function(J){this.$img.style.cssText="width: "+J.w+"px; max-width: "+J.w+"px; height:"+J.h+"px; top: "+J.t+"px; left: "+J.l+"px"};this.setFrom=function(){this.setImgRect({w:F.width,h:F.height,t:0,l:(E.offsetWidth-F.width)/2})};this.setTo=function(){this.setImgRect(this.calcRect())};this.addTitle=function(){if(!this.title){return}this.$caption=B.createElement("div");this.$caption.innerHTML=this.title;this.$caption.className="overlay-title";E.appendChild(this.$caption)};this.removeTitle=function(){this.$caption&&E.removeChild(this.$caption)};var I=this;this.zoomIn=function(){H=this.$img.naturalWidth||this.$img.width;w=this.$img.naturalHeight||this.$img.height;F=this.$img.getBoundingClientRect();E.style.height=F.height+"px";E.classList.add("ready");this.setFrom();this.addTitle();this.$img.classList.add("zoom-in");setTimeout(function(){E.classList.add("active");I.setTo();I.isZoom=true},0)};this.zoomOut=function(){this.isZoom=false;E.classList.remove("active");this.$img.classList.add("zoom-in");this.setFrom();setTimeout(function(){I.$img.classList.remove("zoom-in");I.$img.style.cssText="";I.removeTitle();E.classList.remove("ready");E.removeAttribute("style")},300)};E.addEventListener("click",function(J){I.isZoom?I.zoomOut():J.target.tagName==="IMG"&&I.zoomIn()});B.addEventListener("scroll",function(){I.isZoom&&I.zoomOut()});p.addEventListener("resize",function(){I.isZoom&&I.zoomOut()})}z.call(r(".img-lightbox"),function(w){new d(w)})})(),loadScript:function(d){d.forEach(function(D){var w=B.createElement("script");w.src=D;w.async=true;q.appendChild(w)})}};p.addEventListener("load",function(){h.classList.remove("active");c.page.loaded();p.lazyScripts&&p.lazyScripts.length&&c.loadScript(p.lazyScripts)});p.gEle=function(d){return document.getElementById(d)};p.getjson=function(w,D,E){var d=new XMLHttpRequest;return d.onreadystatechange=function(){4==d.readyState&&(200==d.status?D(JSON.parse(d.response),E):D({code:-502,message:"网络错误"},E))},d.open("GET",w,!0),d.withCredentials=0,d.send(),d};function b(d){gEle("refs").textContent=d.object.sha.substr(0,7)}p.addEventListener("DOMContentLoaded",function(){c.waterfall();var d=A();c.toc.fixed(d);c.toc.actived(d);c.page.loaded();getjson("https://cors.yuangezhizao.workers.dev/?url=https://api.github.com/repos/yuangezhizao/www/git/refs/heads/master",b)});var g=false;var e=k('a[href^="mailto"]');if(e){e.addEventListener(n,function(){g=true})}p.addEventListener("beforeunload",function(d){if(!g){c.page.unload()}else{g=false}});p.addEventListener("pageshow",function(){!c.page.visible&&c.page.loaded()});p.addEventListener("resize",function(){p.BLOG.even=n="ontouchstart" in p?"touchstart":"click";c.toggleMenu();c.waterfall()});t.addEventListener(n,function(){l(c.goTop.bind(c,0))},false);u.addEventListener(n,function(d){c.toggleMenu(true);d.preventDefault()},false);o.addEventListener(n,function(){a.classList.add("hide")},false);x.addEventListener(n,function(d){c.toggleMenu();c.hideOnMask.forEach(function(w){w()});d.preventDefault()},false);B.addEventListener("scroll",function(){var d=A();c.toggleGotop(d);c.fixedHeader(d);c.toc.fixed(d);c.toc.actived(d)},false);if(p.BLOG.SHARE){c.share()}c.noop=f;c.even=n;c.$=k;c.$$=r;Object.keys(c).reduce(function(d,w){d[w]=c[w];return d},p.BLOG);if(p.Waves){Waves.init();Waves.attach(".global-share li",["waves-block"]);Waves.attach(".article-tag-list-link, #page-nav a, #page-nav span",["waves-button"])}else{console.error("Waves loading failed.")}})(window,document);
